<source>
  @type tail
  path /var/log/<%= @dir %>/<%= @name %>
  pos_file /var/log/td-agent/<%= @dir %>/<%= @name %>.pos
  tag <%= @dir %>-<%= @name %>
  format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*) "(?<referer>[^ ]*)" "(?<agent>[^\"]*)" (?<latency>[^ ]*) "(?<forwarded-for>[^\"]*)" "(?<forwarded-proto>[^\"]*)" "(?<personalId>[^\"]*)"$/
  time_format <%= @time_format %>
</source>

<match <%= @dir %>-<%= @name %>>
  @type s3
  format json
  s3_bucket <%= @s3_bucket %>
  s3_region <%= @s3_region %>
  path <%= @dir %>/<%= @name %>/%Y/
  buffer_path /var/log/td-agent/<%= @dir %>/<%= @name %>/
</match>
